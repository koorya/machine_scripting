<StructuredTextModel xmlns="http://schemas.datacontract.org/2004/07/Omron.Cxap.Modules.StructuredText.Core" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Text>;;&#xD;
;&#xD;
CASE down_crab_cycle_state OF&#xD;
	0 : &#xD;
		if start_down_crab_cycle_handle = True then&#xD;
			status_message := 'initialisation';&#xD;
			Y3:=True; //режим пружины&#xD;
			Y6:=true; //верхний разжат&#xD;
			Y7:=true; //нижний сжат&#xD;
			&#xD;
			liftmech.cmd := LIFT_CMD#stop;&#xD;
			start_down_crab_cycle_handle := false;&#xD;
			down_crab_cycle_state:=1;&#xD;
			&#xD;
			last_max_diff:= 30;&#xD;
			err_cnt:=0;&#xD;
		end_if;&#xD;
		&#xD;
	1 :;&#xD;
		if (SQ_DW=16#55555555 ) then ;  &#xD;
			Y1:=False;&#xD;
			Y2:=False;&#xD;
&#xD;
			Y3:=True; //режим пружины&#xD;
			Y6:=true; //верхний разжат&#xD;
			Y7:=false; //нижний разжат&#xD;
&#xD;
&#xD;
			status_message := 'Waiting for bottob locks :\---- ';&#xD;
&#xD;
			down_crab_cycle_state:=20;&#xD;
		end_if;&#xD;
	20:;&#xD;
			if ( not ( SQ1 or   SQ3 or    SQ9 or     SQ11 or    SQ17 or    SQ19 or   SQ25 or    SQ27 ) ) and // :\---- bottom locks&#xD;
		       (       ( SQ2 and SQ4 and SQ10 and SQ12 and SQ18 and SQ20 and SQ26 and SQ28 ) ) then;		&#xD;
				status_message := 'Expanding lift mech. Waiting for complete';&#xD;
				liftmech.cmd := LIFT_CMD#expand;&#xD;
				down_crab_cycle_state:=2;&#xD;
		end_if;&#xD;
&#xD;
	&#xD;
	2:;&#xD;
		if (liftmech.state = LIFT_STATE#expand_end)  then ;  &#xD;
&#xD;
			Y3:=True; //режим пружины&#xD;
			Y6:=true; //верхний расжат&#xD;
			Y7:=true; //нижний cжат&#xD;
			status_message := 'Bottom locks switched to :/----- . Lift mech is reducing, waiting for locks switching complete. lift mech should be between 810 and 880 mm.';&#xD;
			&#xD;
			liftmech.cmd := LIFT_CMD#reduce;&#xD;
			&#xD;
			down_crab_cycle_state:=3;&#xD;
		end_if;&#xD;
	&#xD;
		&#xD;
	3:;		if  (       ( SQ1 and SQ3 and SQ9 and SQ11 and SQ17 and SQ19 and SQ25 and SQ27 ) )  and // bottom locks :/----&#xD;
		   		( not ( SQ2 or   SQ4 or    SQ10 or  SQ12 or    SQ18 or   SQ20 or    SQ26 or   SQ28 ) ) or &#xD;
		   		(liftmech.min_dist &gt;=810 and liftmech.max_dist &lt;=880) then;&#xD;
&#xD;
			status_message := 'Top locks switched to :\----. Lift mech stop.';&#xD;
			Y3:=True; //режим пружины&#xD;
			Y6:=false; //верхний сжат&#xD;
			Y7:=true; //нижний cжат			&#xD;
			&#xD;
&#xD;
			liftmech.cmd := LIFT_CMD#stop;&#xD;
			down_crab_cycle_state:=31;&#xD;
		end_if;&#xD;
	31:;&#xD;
		if (liftmech.state = LIFT_STATE#holding) then ;&#xD;
			liftmech.cmd := LIFT_CMD#expand;&#xD;
			down_crab_cycle_state:=4;&#xD;
			status_message := 'Waiting fo top locks switched to :\----. Lift mech expanding.';&#xD;
&#xD;
		end_if;&#xD;
	4:;		&#xD;
		if (       ( SQ6 and SQ8 and SQ14 and SQ16 and SQ22 and SQ24 and SQ30 and SQ32 ) ) and &#xD;
	       ( not ( SQ5 or   SQ7 or    SQ13 or    SQ15 or   SQ21 or    SQ23 or    SQ29 or   SQ31 ) ) then;&#xD;
				liftmech.cmd := LIFT_CMD#stop;&#xD;
				down_crab_cycle_state:=41;&#xD;
				status_message := 'Lift mech reducing.';&#xD;
			end_if;&#xD;
	41:;&#xD;
		if liftmech.state = LIFT_STATE#holding then ;&#xD;
			liftmech.cmd := LIFT_CMD#reduce;&#xD;
			down_crab_cycle_state:=5;&#xD;
			status_message := 'Waiting for lift mech reduce complete.';&#xD;
		end_if;&#xD;
	5:;&#xD;
		if (liftmech.state = LIFT_STATE#reduce_end)&#xD;
		 then ;  	&#xD;
			&#xD;
			Y3:=True; //режим пружины&#xD;
			Y6:=true; //верхний разжат&#xD;
			Y7:=true; //нижний cжат			&#xD;
			status_message := 'Top locks switched to :/----. Waiting for complete switching. Lift mech expanding.';&#xD;
			&#xD;
			liftmech.cmd := LIFT_CMD#expand;		&#xD;
			&#xD;
			down_crab_cycle_state:=6;&#xD;
		end_if;&#xD;
		&#xD;
	6:;&#xD;
		if ( not	( SQ6  or  SQ8  or    SQ14  or  SQ16  or    SQ22  or    SQ24  or   SQ30  or  SQ32  ) ) and&#xD;
			(       ( SQ5 and	 SQ7 and	SQ13 and SQ15 and	SQ21 and SQ23 and SQ29 and SQ31 ) ) then;&#xD;
			status_message := 'Lift mech stop.';&#xD;
		&#xD;
			liftmech.cmd := LIFT_CMD#stop;&#xD;
			down_crab_cycle_state:=61;&#xD;
		end_if;&#xD;
			&#xD;
	61:;&#xD;
		if liftmech.state = LIFT_STATE#holding then ;&#xD;
			liftmech.cmd := LIFT_CMD#reduce;&#xD;
			down_crab_cycle_state:=7;&#xD;
			status_message := 'Lift mech reducing, waiting for complete.';&#xD;
		end_if;&#xD;
	7:;&#xD;
	&#xD;
		if (liftmech.state = LIFT_STATE#reduce_end) then ;&#xD;
	&#xD;
			liftmech.cmd := LIFT_CMD#stop;&#xD;
			Y3:=false; //режим пружины отменить&#xD;
			down_crab_cycle_state:=99;&#xD;
			status_message := 'Cycle complete.';&#xD;
			&#xD;
		end_if;&#xD;
	&#xD;
	&#xD;
	&#xD;
	99 :; // Processing after normal end&#xD;
	  //up_frame_cycle_state:=INT#0;&#xD;
	98 :; // Processing after error end.&#xD;
		//&#xD;
END_CASE;</Text></StructuredTextModel>