<StructuredTextModel xmlns="http://schemas.datacontract.org/2004/07/Omron.Cxap.Modules.StructuredText.Core" xmlns:i="http://www.w3.org/2001/XMLSchema-instance"><Text>;&#xD;
&#xD;
&#xD;
CASE down_frame_cycle_state OF&#xD;
	0 : &#xD;
		if start_down_frame_cycle_handle = True then&#xD;
			Y3:=True; //режим пружины&#xD;
			Y6:=true; //верхний расжат&#xD;
			Y7:=false; //нижний разжат&#xD;
			status_message := 'initialisation. Waiting for top locks :/----';&#xD;
			&#xD;
			liftmech.cmd := LIFT_CMD#stop;&#xD;
			down_frame_cycle_state:=1;&#xD;
			last_max_diff:= 50;&#xD;
			err_cnt:=0;&#xD;
		end_if;&#xD;
		&#xD;
	1 : &#xD;
		if ( not	( SQ6  or  SQ8  or    SQ14  or  SQ16  or    SQ22  or    SQ24  or   SQ30  or  SQ32  ) ) and // top locks :/-----&#xD;
			(       ( SQ5 and	 SQ7 and	SQ13 and SQ15 and	SQ21 and SQ23 and SQ29 and SQ31 ) ) then;&#xD;
&#xD;
				status_message := 'Lift mech expanding. Waiting for top locks switched into middle :|----, before lift mech &lt; 840 mm';&#xD;
&#xD;
				Y1:=False;&#xD;
				Y2:=False;&#xD;
				liftmech.cmd := LIFT_CMD#expand;&#xD;
				down_frame_cycle_state:=2;&#xD;
			end_if;&#xD;
	2:;&#xD;
		if liftmech.max_dist&gt;840 then;&#xD;
			liftmech.cmd := LIFT_CMD#stop;&#xD;
			status_message := 'Fail: lift mech expand above 840 mm, and top locks not in :|---- pos.';&#xD;
			&#xD;
			down_frame_cycle_state:=98;&#xD;
		end_if;&#xD;
		if (  SQ6 and SQ8 and SQ14 and SQ16 and SQ22 and SQ24 and SQ30 and SQ32 and // top locks :|-----&#xD;
			  SQ5 and	 SQ7 and	SQ13 and SQ15 and SQ21 and SQ23 and SQ29 and SQ31 ) then;&#xD;
			status_message := 'Top locks switch to :\-----. Waiting for expand end.';&#xD;
&#xD;
			Y3:=True; //режим пружины&#xD;
			Y6:=false; //верхний сжат&#xD;
			Y7:=false; //нижний разжат&#xD;
&#xD;
			down_frame_cycle_state:=3;&#xD;
		end_if;&#xD;
		&#xD;
	3:;	&#xD;
		if (liftmech.state = LIFT_STATE#expand_end) then ;  &#xD;
			&#xD;
			status_message := 'Bottom locks switch to :/----. Lift mech reducing. Waitnig for reducing complete.';&#xD;
			&#xD;
			Y3:=True; //режим пружины&#xD;
			Y6:=false; //верхний сжат&#xD;
			Y7:=true; //нижний сжат&#xD;
			&#xD;
			liftmech.cmd := LIFT_CMD#reduce;&#xD;
			down_frame_cycle_state:=4;&#xD;
		end_if;&#xD;
&#xD;
	4:;&#xD;
		&#xD;
		if (liftmech.state = LIFT_STATE#reduce_end) then ;  	&#xD;
			status_message := 'Lift mech expanding. Waiting for expand to 820mm';&#xD;
			&#xD;
			liftmech.cmd := LIFT_CMD#expand;&#xD;
			down_frame_cycle_state:=6;&#xD;
		end_if;&#xD;
&#xD;
		&#xD;
	6:;&#xD;
		if (liftmech.min_dist &gt;= 820) then ;  &#xD;
			Y3:=True; //режим пружины&#xD;
			Y6:=false; //верхний сжат&#xD;
			Y7:=false; //нижний расжат&#xD;
			status_message := 'Bottom locks switch to :\----. Lift mech stop. Waitnig for bottom locks switching complete.';&#xD;
			&#xD;
			liftmech.cmd := LIFT_CMD#stop;&#xD;
			down_frame_cycle_state:=61;&#xD;
		end_if;&#xD;
	61:;&#xD;
		if ( not ( SQ1 or   SQ3 or    SQ9 or     SQ11 or    SQ17 or    SQ19 or   SQ25 or    SQ27 ) ) and // :\---- bottom locks&#xD;
	       (       ( SQ2 and SQ4 and SQ10 and SQ12 and SQ18 and SQ20 and SQ26 and SQ28 ) ) then;		&#xD;
				down_frame_cycle_state:=62;&#xD;
				liftmech.cmd := LIFT_CMD#reduce;&#xD;
				status_message := 'Lift mech reducing. Waitnig for reducing complete.';&#xD;
&#xD;
		end_if;&#xD;
	62:;&#xD;
		if (liftmech.state = LIFT_STATE#reduce_end) then ;  	&#xD;
			status_message := 'Lift mech reducing complete.';&#xD;
			&#xD;
			down_frame_cycle_state:=7;&#xD;
&#xD;
		end_if;	&#xD;
	7:;&#xD;
			Y3:=false; //режим пружины отменить&#xD;
			liftmech.cmd := LIFT_CMD#stop;&#xD;
			status_message := 'Cycle complete.';&#xD;
			down_frame_cycle_state:=99;&#xD;
	99 :; // Processing after normal end&#xD;
&#xD;
	98 :; // Processing after error end.&#xD;
		//&#xD;
END_CASE;&#xD;
&#xD;
start_down_frame_cycle_handle := false;&#xD;
&#xD;
</Text></StructuredTextModel>